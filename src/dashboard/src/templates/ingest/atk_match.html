{% extends "layout_fluid.html" %}

{% block title %}Match{% endblock %}
{% block h1 %}Match{% endblock %}
{% block page_id %}atk_match{% endblock %}

{% block css %}
<link type="text/css" rel="stylesheet" media="all" href="{{ STATIC_URL }}css/atk_match.css" />
{% endblock %}

{% block js %}
<script type="text/javascript" src="{{ STATIC_URL }}js/ingest/atk_matcher.js"></script>

  <script type="text/javascript">
    $(document).ready(function()
      {
        var matcher = new ATKMatcherView({
          'el':                 $('#atk_matcher'),
          'objectPaneCSSId':    'object_pane',
          'objectPathTemplate': $('#object-path-template').html(),
          'resourcePaneCSSId':  'resource_pane',
          'matchPaneCSSId':     'match_pane',
          'objectPaths':        {{ object_path_json|safe }},
          'resourceData':       {{ resource_data_json|safe }},
       });

        matcher.render();
    });

    function renderResourceData(destCssId, resourceData, level) {
      level = level || 0;
      $('#' + destCssId).append('<p>');
      for (var index = 0; index < level; index++) {
        $('#' + destCssId).append('&nbsp;&nbsp;');
      }
      $('#' + destCssId).append(resourceData.title);
      $('#' + destCssId).append('</p>');
      if (resourceData.children) {
        resourceData.children.forEach(function(child) {
          renderResourceData(destCssId, child, level + 1);
        });
      }
    }
  </script>
{% endblock %}

{% block content %}
<div id='atk_matcher'></div>

  <!-- Templates -->

  <script type="text/template" id="object-path-template">
    <div class="atk-matcher-object-path">
      <%= path %>
    </div>
  </script>

{% endblock %}
