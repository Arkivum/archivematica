{% extends "layout_fluid.html" %}

{% load math %}
{% load percentage %}

{% block title %}Preservation planning{% endblock %}
{% block h1 %}Preservation planning{% endblock %}
{% block page_id %}preservation-planning{% endblock %}

{% block css %}
<style type="text/css">
    table {
        border: 1px solid #000000;/*#eee;*/

    }

    td, th {
        border-radius:5px 5px 0px 0px;
        border: 1px solid #000000;/*#eee;*/
        text-align: left;
    }

    thead > tr > th {
        background-color: #ddd;
        background: -moz-linear-gradient(100% 100% 90deg, #bbbbbb, #ddd);
        background: -webkit-linear-gradient(#bbbbbb, #ddd);
    }

    td.file-type {
        font-size: 14px;
        vertical-align: top;
        background-color: #ddd;
        background: -moz-linear-gradient(100% 100% 90deg, #eee, #ddd);
        background: -webkit-linear-gradient(#eee, #fff);
    }

    tr.row-header > th {
        background-color: #ffedb7 !important;
    }

    th.advanced {
        background-color: #ffedb7 !important;
    }

    td.advanced:first-child {
        border: 0;
    }

    #btn_advanced_details {
        font-weight: normal;
        float: right;
    }

    tr.hover > td {
        background-color: #ffedb7;
    }

    td.per {
        width: 40px;
        text-align: right;
    }

    th.per {
        text-align: center;
        width: 40px;
    }

    div.cmd {
        display: inline-block;
    }

    div.shownCmd {
        float: right;
        text-align: right;
    }

</style>
{% endblock %}

{% block js %}
<script type="text/javascript">
    $(document).ready(function()
    {
        $th = $('thead > tr > th:last');

        $('tbody tr').hover(function()
        {
            $(this).addClass('hover');
        }, function()
        {
            $(this).removeClass('hover');
        });

        var link = '<a href="">Show</a>';

        $('td.cmd > div')
            .hide()
            .after(link).next().click(function(event)
            {
                event.preventDefault();

                if ('Show' == $(this).text())
                {
                    var content = $(this).prev().clone();
                    var width = $(this).closest('table').find('th:eq(1)').width();

                    $(this)
                        .text('Hide')
                        .closest('tr').after('<tr><td colspan="10" style="border:5px solid black"></td></tr>').next()
                        .children().append(content).find('div')
                        .css({'overflow': 'auto', 'padding': '3px', 'white-space': 'pre',
                                'font-family': 'courier', 'background-color': '#ddd'})
                        .slideDown(1000);

                    var $header = $(this).closest('tr').prevAll('tr.row-header:first').find('td:first');
                    $header.attr('rowspan', parseInt($header.attr('rowspan')) + 1);
                }
                else
                {
                    $(this).closest('tr').next().remove();
                    $(this).text('Show');

                    var $header = $(this).closest('tr').prevAll('tr.row-header:first').find('td:first');
                    $header.attr('rowspan', parseInt($header.attr('rowspan')) - 1);
                }
            });

    });
</script>
{% endblock %}

{% block content %}
  
<form action='{% url components.preservation_planning.views.preservation_planning_fpr_search %}' method='GET'>
  {{ form }}
  <input type='submit' value='Search files'/>
</form>

<!-- Testing if we're in a search query between paginations or not.... -->
{% if request.session.fpr_query != '' %}
  <h2>Search results for &quot;{{ request.session.fpr_query }}&quot; ({{ hit_count }} results):</h2><br>
{% else %} 
  <h2>Format policies ({{ item_count }} items):</h2><br>
{% endif %}

<table style="width:100%;table-layout:auto;word-wrap:break-word" class="FileIDsTable">

<thead style="color:black;">
<tr class="row-header">
  <th> Format </th>
  <th> Tool </th>
  <th> Tool version </th>
  <th> Description </th>
  <th> Valid preservation format</th>
  <th> Valid access format</th>
  <th> Classification </th>
  <th> Output </th>
  <th> Command </th>
  <th> Command Description </th>
</tr>
</thead>
<tbody>

{% for row in page.objects %}

<tr>
  <td><div style="width:70px;">{{ row.id }}</div></td>
  <td><div style="width:120px;">{{ row.tool }}</div></td>
  <td>{{ row.toolVersion }}</td>
  <td><div style="width:400px;">{{ row.FileIDs_description }}</div></td>
  <td>{{ row.FileIDs_validPreservationFormat }}</td>
  <td>{{ row.FileIDs_validAccessFormat }}</td>
  <td>{{ row.classification }}</td>
  <td>{{ row.outputLocation }}</td>
  <td class="cmd"><div class="cmd">{{ row.Commands_command }}</div></td>
  <td>{{ row.Commands_description }}</td>
</tr>

{% endfor %}

</tbody>
</table>

  {% if page.has_other %}
    <center>
    <div align=center style='float:center'>
    {% if page.has_previous %}

      {% if request.session.fpr_query == '' %}
        <a href="{% url components.preservation_planning.views.preservation_planning_fpr_data page.previous %}" class="btn">Previous</a>
      {% else %}
        <a href="{% url components.preservation_planning.views.preservation_planning_fpr_search page.previous %}" class="btn">Previous</a>
      {% endif %}

      {% if page.has_next %}
        &nbsp;
      {% endif %}
 
   {% endif %}
   
   {% if page.has_next %}
      {% if request.session.fpr_query == '' %}  
        <a href="{% url components.preservation_planning.views.preservation_planning_fpr_data page.next %}" class="btn">Next</a>
      {% else %}
        <a href="{% url components.preservation_planning.views.preservation_planning_fpr_search page.next %}" class="btn">Next</a>
      {% endif %}
   {% endif %}

    </div><br>
  {% endif %}
  Page {{ current_page_number }} of {{ page.num_pages }}

  {% if request.session.fpr_query != '' %}
    | <a href="{% url components.preservation_planning.views.preservation_planning_fpr_data 1 %}">Exit Search</a>
  {% endif %}


{% endblock %}
